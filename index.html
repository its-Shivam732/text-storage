<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Storage - Concatenation Mode</title>
    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f7f9fc;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .description {
            margin-bottom: 20px;
            text-align: center;
            color: #7f8c8d;
        }
        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 20px;
            resize: vertical;
            box-sizing: border-box;
        }
        #textArea {
            height: 150px;
        }
        #allStoredText {
            height: 300px;
            background-color: #f9f9f9;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .add-btn {
            background-color: #2ecc71;
        }
        .add-btn:hover {
            background-color: #27ae60;
        }
        .download-btn {
            background-color: #9b59b6;
        }
        .download-btn:hover {
            background-color: #8e44ad;
        }
        .clear-btn {
            background-color: #e74c3c;
        }
        .clear-btn:hover {
            background-color: #c0392b;
        }
        .status {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 14px;
            color: #7f8c8d;
        }
        .section-header {
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            color: #2c3e50;
        }
        .separator {
            margin: 30px 0;
            border-top: 1px dashed #ddd;
        }
        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Text Storage</h1>
        <p class="description">Add text to be stored. New text will be concatenated with previously stored text.</p>
        
        <!-- Add New Text Section -->
        <div>
            <textarea id="textArea" placeholder="Type or paste new text here..."></textarea>
            <div class="button-group">
                <button class="add-btn" id="addTextBtn">Add Text</button>
            </div>
        </div>
        
        <div class="separator"></div>
        
        <!-- All Stored Text Section -->
        <h3 class="section-header">All Stored Text</h3>
        <textarea id="allStoredText" readonly placeholder="All stored text will appear here..."></textarea>
        <div class="button-group">
            <button class="download-btn" id="downloadBtn">Download All Text</button>
            <button class="clear-btn" id="clearBtn">Clear All Text</button>
        </div>
        
        <div id="statusMsg" class="status"></div>
    </div>
    <div class="footer">
        <p>Text is stored in a Firebase database and concatenated with each addition.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase (replace with your own Firebase project config)
                  const firebaseConfig = {
                
                  apiKey: "AIzaSyBnA0VchettkJYHaaxPZyd_nSxGCbk3mm4",
                
                  authDomain: "my-db-c798e.firebaseapp.com",
                
                  projectId: "my-db-c798e",
                
                  storageBucket: "my-db-c798e.firebasestorage.app",
                
                  messagingSenderId: "751926716658",
                
                  appId: "1:751926716658:web:5d6839b66d9ca6cf16886b",
                
                  measurementId: "G-1S6C35P06B"
                
                };


            
            // Initialize Firebase - you'll need to replace the config above with your own
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            
            // Document ID for storing all text (using a fixed ID makes it easier to manage)
            const TEXT_STORAGE_DOC_ID = "all_text_storage";

            // DOM Elements
            const textArea = document.getElementById('textArea');
            const allStoredText = document.getElementById('allStoredText');
            const addTextBtn = document.getElementById('addTextBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const clearBtn = document.getElementById('clearBtn');
            const statusMsg = document.getElementById('statusMsg');

            // Load all stored text on page load
            loadAllStoredText();

            // Function to load all stored text
            function loadAllStoredText() {
                db.collection('texts').doc(TEXT_STORAGE_DOC_ID).get()
                .then((doc) => {
                    if (doc.exists && doc.data().content) {
                        allStoredText.value = doc.data().content;
                    } else {
                        allStoredText.value = "";
                        // Create the document if it doesn't exist
                        db.collection('texts').doc(TEXT_STORAGE_DOC_ID).set({
                            content: "",
                            updatedAt: new Date()
                        });
                    }
                })
                .catch((error) => {
                    showStatus('Error loading text: ' + error.message, false);
                });
            }

            // Add text to storage (concatenate with existing text)
            addTextBtn.addEventListener('click', function() {
                const newText = textArea.value.trim();
                
                if (!newText) {
                    showStatus('Please enter some text to add', false);
                    return;
                }
                
                db.collection('texts').doc(TEXT_STORAGE_DOC_ID).get()
                .then((doc) => {
                    let existingText = "";
                    
                    if (doc.exists && doc.data().content) {
                        existingText = doc.data().content;
                    }
                    
                    // Add a line break if there's existing text
                    const separator = existingText ? "\n\n" : "";
                    
                    // Concatenate existing text with new text
                    const updatedText = existingText + separator + newText;
                    
                    // Update the document with concatenated text
                    return db.collection('texts').doc(TEXT_STORAGE_DOC_ID).set({
                        content: updatedText,
                        updatedAt: new Date()
                    });
                })
                .then(() => {
                    // Update the display
                    loadAllStoredText();
                    // Clear the input area
                    textArea.value = "";
                    showStatus('Text added successfully!', true);
                })
                .catch((error) => {
                    showStatus('Error adding text: ' + error.message, false);
                });
            });

            // Download all text
            downloadBtn.addEventListener('click', function() {
                const text = allStoredText.value.trim();
                
                if (!text) {
                    showStatus('No text to download', false);
                    return;
                }
                
                downloadTextAsFile(text);
            });

            // Clear all text (delete from database)
            clearBtn.addEventListener('click', function() {
                if (confirm("Are you sure you want to clear all stored text? This cannot be undone.")) {
                    db.collection('texts').doc(TEXT_STORAGE_DOC_ID).set({
                        content: "",
                        updatedAt: new Date()
                    })
                    .then(() => {
                        allStoredText.value = "";
                        showStatus('All text cleared!', true);
                    })
                    .catch((error) => {
                        showStatus('Error clearing text: ' + error.message, false);
                    });
                }
            });

            // Helper function to download text as file
            function downloadTextAsFile(text) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'all_text_' + getFormattedDate() + '.txt';
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus('Text downloaded successfully!', true);
            }

            // Show status message
            function showStatus(message, isSuccess) {
                statusMsg.textContent = message;
                statusMsg.style.display = 'block';
                
                if (isSuccess) {
                    statusMsg.className = 'status success';
                } else {
                    statusMsg.className = 'status error';
                }
                
                setTimeout(function() {
                    statusMsg.style.display = 'none';
                }, 3000);
            }

            // Get formatted date for filename
            function getFormattedDate() {
                const date = new Date();
                return date.getFullYear() + '-' + 
                       padZero(date.getMonth() + 1) + '-' + 
                       padZero(date.getDate()) + '_' + 
                       padZero(date.getHours()) + '-' + 
                       padZero(date.getMinutes());
            }

            // Pad with zero for single digits
            function padZero(num) {
                return num.toString().padStart(2, '0');
            }
        });
    </script>
</body>
</html>
